-- [Vampire Fang + Demonic Wisp + Dark Fragment + Race Display] - Rainbow LED Border (getcy style)
repeat task.wait() until game:IsLoaded() and game.Players.LocalPlayer:FindFirstChild("DataLoaded")

if game:GetService("Players").LocalPlayer.PlayerGui:FindFirstChild("Main (minimal)") then
    repeat
        task.wait()
    until not game:GetService("Players").LocalPlayer.PlayerGui:FindFirstChild("Main (minimal)")
end

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local player = Players.LocalPlayer

-- === UI setup ===
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "MaterialRaceDisplay"
screenGui.ResetOnSpawn = false
screenGui.Parent = player:WaitForChild("PlayerGui")

-- Frame chính với viền led cầu vồng
local frame = Instance.new("Frame")
frame.Position = UDim2.new(0.02, 0, 0.13, 0)
frame.Size = UDim2.new(0, 170, 0, 0)
frame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
frame.BackgroundTransparency = 0
frame.BorderSizePixel = 0
frame.AutomaticSize = Enum.AutomaticSize.Y
frame.Parent = screenGui

-- UICorner cho bo tròn góc
local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 12)
corner.Parent = frame

-- UIStroke + UIGradient cho viền led cầu vồng động
local stroke = Instance.new("UIStroke")
stroke.Thickness = 3
stroke.Color = Color3.fromRGB(255, 255, 255)
stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
stroke.Parent = frame

local uiGradient = Instance.new("UIGradient")
uiGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 0, 0)),
    ColorSequenceKeypoint.new(0.166, Color3.fromRGB(255, 255, 0)),
    ColorSequenceKeypoint.new(0.333, Color3.fromRGB(0, 255, 0)),
    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(0, 255, 255)),
    ColorSequenceKeypoint.new(0.666, Color3.fromRGB(255, 0, 255)),
    ColorSequenceKeypoint.new(0.833, Color3.fromRGB(255, 0, 127)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 102, 0))
}
uiGradient.Rotation = 45
uiGradient.Parent = stroke

-- Hiệu ứng chuyển động cầu vồng
task.spawn(function()
    while true do
        TweenService:Create(uiGradient, TweenInfo.new(3, Enum.EasingStyle.Linear), {Rotation = 360}):Play()
        wait(3)
        uiGradient.Rotation = 0
    end
end)

-- Layout
local layout = Instance.new("UIListLayout")
layout.Parent = frame
layout.FillDirection = Enum.FillDirection.Vertical
layout.SortOrder = Enum.SortOrder.LayoutOrder
layout.Padding = UDim.new(0, 1)

-- Hàm tạo label
local function createLabel(text)
    local label = Instance.new("TextLabel")
    label.BackgroundTransparency = 1
    label.TextColor3 = Color3.fromRGB(255, 255, 255)
    label.Font = Enum.Font.SourceSansBold
    label.TextSize = 20
    label.TextXAlignment = Enum.TextXAlignment.Center
    label.Size = UDim2.new(1, -10, 0, 23)
    label.Text = text
    label.Parent = frame
    return label
end

local vampireLabel   = createLabel("Vampire Fang: ...")
local wispLabel      = createLabel("Demonic Wisp: ...")
local fragmentLabel  = createLabel("Dark Fragment: ...")

-- Frame riêng cho Race
local raceFrame = Instance.new("Frame")
raceFrame.Size = UDim2.new(1, -10, 0, 23)
raceFrame.BackgroundTransparency = 1
raceFrame.Parent = frame

local raceLabel = Instance.new("TextLabel")
raceLabel.BackgroundTransparency = 1
raceLabel.Text = "Race: ..."
raceLabel.Font = Enum.Font.SourceSansBold
raceLabel.TextSize = 20
raceLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
raceLabel.TextXAlignment = Enum.TextXAlignment.Center
raceLabel.Size = UDim2.new(1, 0, 1, 0)
raceLabel.Parent = raceFrame

-- === Function đếm item theo tên ===
local function CountItem(itemName)
    local inventory = game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("getInventory")
    local count = 0
    for _,v in pairs(inventory) do
        if type(v) == "table" and v.Name == itemName then
            count = count + (v.Count or 1)
        end
    end
    return count
end

-- === Function lấy Race ===
local function getRace()
    local data = player:FindFirstChild("Data")
    if not data then
        return "Unknown"
    end
    return data:FindFirstChild("Race") and data.Race.Value or "Unknown"
end

-- === Update loop ===
task.spawn(function()
    while true do
        local vampire  = CountItem("Vampire Fang")
        local wisp     = CountItem("Demonic Wisp")
        local fragment = CountItem("Dark Fragment")
        local race     = getRace()

        vampireLabel.Text  = "Vampire Fang: " .. vampire
        wispLabel.Text     = "Demonic Wisp: " .. wisp
        fragmentLabel.Text = "Dark Fragment: " .. fragment
        raceLabel.Text     = "Race: " .. race

        -- Đổi màu theo điều kiện nguyên liệu
        vampireLabel.TextColor3  = vampire < 20 and Color3.fromRGB(255,0,0) or Color3.fromRGB(0,255,0)
        wispLabel.TextColor3     = wisp < 20 and Color3.fromRGB(255,0,0) or Color3.fromRGB(0,255,0)
        
        -- Dark Fragment: 0-1 đỏ, 2 vàng, 3+ xanh
        if fragment <= 1 then
            fragmentLabel.TextColor3 = Color3.fromRGB(255,0,0)
        elseif fragment == 2 then
            fragmentLabel.TextColor3 = Color3.fromRGB(255,255,0)
        else
            fragmentLabel.TextColor3 = Color3.fromRGB(0,255,0)
        end

        -- Đổi màu theo Race
        if race == "Cyborg" then
            raceLabel.TextColor3 = Color3.fromRGB(170, 0, 255)
        elseif race == "Angel" then
            raceLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
        elseif race == "Human" then
            raceLabel.TextColor3 = Color3.fromRGB(255, 105, 180)
        elseif race == "Fishman" then
            raceLabel.TextColor3 = Color3.fromRGB(0, 128, 255)
        elseif race == "Mink" then
            raceLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
        else
            raceLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
        end

        task.wait()
    end
end)
